<tool id="fastk" name="FastK" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="20.01">
    <description>A k-mer counter for high-quality assembly datasets.</description>
    <macros>
        <token name="@TOOL_VERSION@">1.0</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <requirements>
        <requirement type="package" version="1.0.0">fastk</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        mkdir -p outfiles/tmpfiles && 
        cd outfiles &&
        ln -s '$infile' input.fasta &&
        FastK input.fasta
        #set kmer_size=$kmer_size
        -k$kmer_size 
        #if $sorted_table.sorted_table_presence == 'yes':
            #if $sorted_table.type_sorted_table.sorted_table_options == 'default_sorted_table':
                -t 
            #elif $sorted_table.type_sorted_table.sorted_table_options == 'cutoff_sorted_table':
                #set sorted_table_cutoff=$sorted_table.type_sorted_table.sorted_table_cutoff
                -t$sorted_table_cutoff 
            #end if
        #end if
        -T\${GALAXY_SLOTS:-1} -Noutput -Ptmpfiles
        #if $sorted_table.sorted_table_presence == 'yes':
            && Tabex output.ktab -t${sorted_table.advanced.tabex_threshold} LIST > tabex.txt
            && mv tabex.txt ..
        #end if
        && tar -c -f fastk.tar ./*
    ]]></command>
    <inputs>
        <param name="infile" type="data" format="fasta,fasta.gz,fastq,fastq.gz,cram,bam,sam" label="Input file" />
        <param name="kmer_size" type="integer" min="5" max="50" value="40" label="K-mer size" help="Default k-mer size is 40." />
        <conditional name="sorted_table">
            <param name="sorted_table_presence" type="select" label="Sorted table selection" help="Do you want a sorted table of all canonical k-mers and their counts?">
                <option value="no">No</option>
                <option value="yes">Yes</option>
            </param>
            <when value="no"/>
            <when value="yes">
                <conditional name="type_sorted_table">
                    <param name="sorted_table_options" type="select" label="Sorted table presence" help="Do you want to specify a cut-off?">
                        <option value="default_sorted_table">default (1)</option>
                        <option value="cutoff_sorted_table">specify cutoff</option>
                    </param>
                    <when value="default_sorted_table"/>
                    <when value="cutoff_sorted_table">
                        <param name="sorted_table_cutoff" type="integer" min="2" value="10" label="Sorted table cutoff value"/>
                    </when>
                </conditional>
                <section title="Advanced" name="advanced">
                    <param name="tabex_threshold" label="Tabex count threshold" type="integer" value="5" min="1"/>
                </section>
            </when>
        </conditional>

    </inputs>
    <outputs>
        <data name="fastk_hist" format="tar" from_work_dir="outfiles/fastk.tar" label="${tool.name} on ${on_string}: FastK hist files"/>
        <data name="tabex_hist" format="txt" from_work_dir="tabex.txt" label="${tool.name} on ${on_string}: Tabex output">
            <filter>sorted_table['sorted_table_presence']=="yes"</filter>
        </data>
    </outputs>
    <help><![CDATA[
        FastK is a kâ€‘mer counter that is optimized for processing high quality DNA assembly data sets such as those produced with an Illumina instrument or a PacBio run in HiFi mode.
    ]]></help>
    <!-- <expand macro="citations"/> -->
</tool>

